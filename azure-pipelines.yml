# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

stages:
- stage: Build
  jobs:
  - job: Build
    steps:
    - task: DockerBuild@1  # Build the container image
      inputs:
        dockerfilePath: $(System.DefaultWorkingDirectory)/Dockerfile
        imageTag: $(ACRName).azurecr.io/$(imageName):latest

    - task: DockerPush@1  # Push the image to ACR
      inputs:
        registryConnection: $(ACRConnection)
        serviceConnectionName: $(ACRConnection)
        imageName: $(ACRName).azurecr.io/$(imageName):latest
        passwordSecretName: $(ACRPassword)

- stage: Deploy (Optional)  # Add this stage for deployment
  jobs:
  - job: Deploy
    steps:
    - task: KubernetesManifest@0  # Deploy manifests using Helm/Kustomize/kubectl
      inputs:
        helmChart: $(System.DefaultWorkingDirectory)/charts/my-app  # Example Helm chart location
        # OR
        manifestsLocation: $(System.DefaultWorkingDirectory)/k8s  # Location of deployment/service YAMLs
        namespace: default
        kubernetesConnection: $(AKSConnection)
        # Further configuration options based on chosen deployment method
